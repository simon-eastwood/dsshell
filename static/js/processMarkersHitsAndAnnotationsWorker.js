!function(e){var r={};function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)n.d(t,a,function(r){return e[r]}.bind(null,a));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=0)}([function(e,r,n){"use strict";function t(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var n=[],t=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(t=(o=u.next()).done)&&(n.push(o.value),!r||n.length!==r);t=!0);}catch(c){a=!0,i=c}finally{try{t||null==u.return||u.return()}finally{if(a)throw i}}return n}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}n.r(r);var i=new(function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,n,i;return r=e,(n=[{key:"process",value:function(e,r,n){var a=t(this.mapPagesByVisibleChars(e),2),i=a[0],o=a[1];return{markersHitsPerPage:this.mapMarkersHits(r,i),annotationsPerPage:this.mapAnnotations(n,i),meta:e,metaCalculated:o}}},{key:"mapPagesByVisibleChars",value:function(e){var r=e.length&&e[0].hasOwnProperty("visibleCharactersBefore"),n=0;return[e.map((function(e){var t=e.visibleCharacters,a=e.num,i=[n,n+t];return!r&&(e.visibleCharactersBefore=n),n+=t,{num:a,pageBoundaries:i}})),!r]}},{key:"mapMarkersHits",value:function(e,r){var n=this,a={};return e&&Object.entries(e).forEach((function(e){var i=t(e,2),o=i[0];i[1].forEach((function(e){var t=n.findPage4Element(e,r);if(null!==t){var i=n.getOrCreateObject(t,a);n.getOrCreateObject(o,i,Array).push(n.getPagePosition(t,e,r))}}))})),Object.keys(a).forEach((function(e){var r=a[e];Object.keys(r).forEach((function(e){return r[e].sort((function(e,r){return t(e,1)[0]-t(r,1)[0]}))}))})),a}},{key:"mapAnnotations",value:function(e,r){var n=this,a={};return e&&Object.entries(e).filter((function(e){return"link"!==t(e,1)[0]})).forEach((function(e){var i=t(e,2),o=i[0];i[1].forEach((function(e){var i=n.findPage4Element(e,r,!0);if(null!==i){var u=function(r,i){var u=t(e,4),c=u[2],f=u[3],l=f.color,s=f.filterBy,v=n.getOrCreateObject(r,a),p=n.getOrCreateObject(o,v);n.getOrCreateObject(s,p,Array).push({id:c,color:l,position:i})},c=n.getPagePosition(i,e,r);c instanceof Array?u(i,c):Object.entries(c).forEach((function(e){var r=t(e,2),n=r[0],a=r[1];return u(n,a)}))}}))})),Object.keys(a).forEach((function(e){var r=a[e];Object.entries(r.underlines).forEach((function(e){var n=t(e,2),a=n[0],i=n[1];r.underlines[a]=i.sort((function(e,r){var n=e.position,t=r.position;return n[0]-t[0]})).reduce((function(e,r){if(e.length){var n=e[e.length-1],a=n.id,i=n.position,o=r.id,u=r.position;if(a===o){var c=t(i,2)[1],f=t(u,4),l=f[0],s=f[1],v=f[3];if(c===l)return i[1]=s,i[3]=v,e}}return e.push(r),e}),[])}))})),a}},{key:"getOrCreateObject",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object,t=r[e];return!t&&(r[e]=t=new n),t}},{key:"getPagePosition",value:function(e,r,n){var a=t(r,2),i=a[0],o=a[1],u=t(n[e].pageBoundaries,2),c=u[0],f=u[1],l=i-c,s=l+(o-i);if(s<=f-c)return[l,s,i,o];for(var v,p,b,g=(b=[l,f-c,i,o],(p=e)in(v={})?Object.defineProperty(v,p,{value:b,enumerable:!0,configurable:!0,writable:!0}):v[p]=b,v),y=e+1,d=n[y],h=o-f;d;d=n[++y]){var m=t(d.pageBoundaries,2),O=m[0],P=m[1]-O;if(!(h>P)){g[y]=[0,h,i,o];break}h-=P,g[y]=[0,P,i,o]}return g}},{key:"findPage4Element",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=Math.floor(r.length/2),i=r[a];if(!i)return null;var o=t(e,2),u=o[0],c=o[1],f=t(i.pageBoundaries,2),l=f[0],s=f[1];if(u>=l&&u<s)return c>s&&!n?(console.info("Element lasts outside a page"),null):i.num-1;var v=u<l?a:-(r.length-a-1);return 0!==v?this.findPage4Element(e,v>0?r.slice(0,v):r.slice(v),n):null}}])&&a(r.prototype,n),i&&a(r,i),e}());self.workerHandle=function(e){var r=e.meta,n=e.markersHits,t=e.annotations;return i.process(r,n,t)}}]);
//# sourceMappingURL=processMarkersHitsAndAnnotationsWorker.js.map